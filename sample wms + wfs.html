<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <title>Winongo WebGIS</title>
   
    <link rel="stylesheet" href="http://bootswatch.com/flatly/bootstrap.min.css" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" />
	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.5.4/bootstrap-select.min.css"/>
	<link rel="stylesheet" href="../assets/bootstrap-slider/css/bootstrap-slider.css"/>
	<link rel="stylesheet" href="../assets/css/map_css.css"/>
		
    <link rel="stylesheet" href="../assets/ol/ol.css" type="text/css" />
    <script src="../assets/ol/ol.js"></script>
	<script src="../assets/ol/ol-popup.js"></script>
	<script src="../assets/ol/filter.js"></script>
	<script type="text/javascript" src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.5.4/bootstrap-select.js"></script>
	<script src="../assets/bootstrap-slider/js/bootstrap-slider.js"></script>
	
    <script type="text/javascript">
      $(function (){

			wmsserver = "http://localhost:9090/geoserver/winongo/wms";
			wfsserver = 'http://localhost:9090/geoserver/wfs?service=WFS&';
			 osm = new ol.layer.Tile({
            source: new ol.source.OSM()
          });
			 
                map = new ol.Map({
        target: 'map',
		controls: [
		        new ol.control.MousePosition({
                    undefinedHTML: 'outside',
                    projection: 'EPSG:4326',
                    coordinateFormat: function(coordinate) {
                        return ol.coordinate.format(coordinate, '<b><center>{x} | {y}<br>EPSG : 4326</center></b>', 5);
                    }
                }),
                new ol.control.ScaleLine(),
                new ol.control.Zoom(),
                new ol.control.ZoomSlider()
		],
        view: new ol.View({
          center: ol.proj.transform([110.35399, -7.80751], 'EPSG:4326', 'EPSG:900913'),
          zoom: 16
        })
      });
			
			map.addLayer(osm);

geojsonFormat = new ol.format.GeoJSON();

sourcekec = new ol.source.Vector({
  loader: function(extent, resolution, projection) {
    var url = wfsserver +
        'version=1.1.0&request=GetFeature&typename=winongo:batas_kec&' +
        'outputFormat=text/javascript&format_options=callback:loadkec' +
        '&srsname=EPSG:3857&bbox=' + extent.join(',') + ',EPSG:3857';
    // use jsonp: false to prevent jQuery from adding the "callback"
    // parameter to the URL
    $.ajax({url: url, dataType: 'jsonp', jsonp: false});
  },
  strategy: ol.loadingstrategy.tile(ol.tilegrid.createXYZ({
    maxZoom: 19
  }))
});
window.loadkec = function(response) {
  sourcekec.addFeatures(geojsonFormat.readFeatures(response));
};
stylekec = function(feature, resolution) {
                return [new ol.style.Style({
                    text: new ol.style.Text({
                        font: 'bold 11px Arial, monospace',
                        text: feature.get('kecamatan'),
                        fill: new ol.style.Fill({
                            color: '#4f4f4f'
							}),
                        stroke: new ol.style.Stroke({
                            color: '#b7b7b7',
                            width: 3
                        })
                    }),
					stroke: new ol.style.Stroke({
                        width: 3,
                        color: 'rgba(0, 0, 0, 0.6)',
						lineDash: [6,8]
                    })
                })];
            };  
			
stylekec2 = function(feature, resolution) {
                return [new ol.style.Style({
rules:[
new ol.style.Rule({
  filter: new ol.filter.Filter(function(feature) {
    return feature.get('kecamatan') == 'Wirobrajan';
  }),
  symbolizers: [
   new ol.style.Fill({
      color: '#ffffff',
      opacity: 0.25
    }),
    new ol.style.Stroke({
      color: '#6666ff'
    }),
	new ol.style.Text({
                        font: 'bold 11px Arial, monospace',
                        text: feature.get('kecamatan'),
                        fill: new ol.style.Fill({
                            color: '#4f4f4f'
							})
							})
  ]
  })
]
				})];
};
			
kec = new ol.layer.Vector({
  source: sourcekec,
  style: stylekec2
  });

     
   sourceinfra_ipal = new ol.source.Vector({
  loader: function(extent, resolution, projection) {
    var url = wfsserver +
        'version=1.1.0&request=GetFeature&typename=winongo:usulan_titik_kumpul&' +
        'outputFormat=text/javascript&format_options=callback:loadinfra_ipal' +
        '&srsname=EPSG:3857&bbox=' + extent.join(',') + ',EPSG:3857';
    // use jsonp: false to prevent jQuery from adding the "callback"
    // parameter to the URL
    $.ajax({url: url, dataType: 'jsonp', jsonp: false});
  },
  strategy: ol.loadingstrategy.tile(ol.tilegrid.createXYZ({
    maxZoom: 19
  }))
});
window.loadinfra_ipal = function(response) {
  sourceinfra_ipal.addFeatures(geojsonFormat.readFeatures(response));
};
styleinfra_ipal = new ol.style.Style({
  image: new ol.style.Circle({
                    radius: 5,
                    fill: new ol.style.Fill({
                        color: '#FFffff'
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#FF0000',
                        width: 2
                    })
                })
});
infra_ipal = new ol.layer.Vector({
  source: sourceinfra_ipal,
  style:styleinfra_ipal
  });
  
  sourcependuduk = new ol.source.Vector({
  loader: function(extent, resolution, projection) {
    var url = wfsserver +
        'version=1.1.0&request=GetFeature&typename=winongo:analisis_centro_penduduk&' +
        'outputFormat=text/javascript&format_options=callback:loadpenduduk' +
        '&srsname=EPSG:3857&bbox=' + extent.join(',') + ',EPSG:3857';
    // use jsonp: false to prevent jQuery from adding the "callback"
    // parameter to the URL
    $.ajax({url: url, dataType: 'jsonp', jsonp: false});
  },
  strategy: ol.loadingstrategy.tile(ol.tilegrid.createXYZ({
    maxZoom: 19
  }))
});
window.loadpenduduk = function(response) {
  sourcependuduk.addFeatures(geojsonFormat.readFeatures(response));
};
  kep_penduduk = new ol.layer.Heatmap({
  source: sourcependuduk,
  radius: 7,
  opacity: 0.3
});
	
	stylecentro = new ol.style.Style({
  image: new ol.style.RegularShape({
            points: 4,
            radius1: 4,
            radius2: 3,
            angle: 45,
            fill: new ol.style.Fill({color:'rgba(250,128,114, 0.4)'}),
        })
});
	
centro_penduduk = new ol.layer.Vector({
  source: sourcependuduk,
  style:stylecentro
  });
	
		map.addLayer(kec);
		kec.setVisible(true);

		map.addLayer(centro_penduduk);
		centro_penduduk.setVisible(false);
		
map.addLayer(kep_penduduk);
		kep_penduduk.setVisible(false);
	
		map.addLayer(infra_ipal);
		infra_ipal.setVisible(false);

      });
	  
    </script>
	
  </head>
  <body>
	
    <div class="container">
		<nav class="navbar navbar-fixed-top navbar-inverse" role="navigation">
			<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
				<div class="navbar-header">
					<label class="judul">Web Geospasial</label>
					<label class="judul3">Penyajian data geospasial dengan OpenLayers 3 JS style</label>
					<label class="judul2">Dibuat Oleh : Miranty Noor Sulistyawati</br>S2 Teknik Geomatika UGM</br>Dosen Pengampu : Dr. Trias Aditya</label>
					
				</div>
			</div><!-- /.container-fluid -->
		</nav>
	</div>
      
    
    
	<div id="map"></div>
	<div id="popup" class="ol-popup">
      <a href="#" id="popup-closer" class="ol-popup-closer"></a>
      <div id="popup-content"></div>
    </div>
	
  </body>
</html>